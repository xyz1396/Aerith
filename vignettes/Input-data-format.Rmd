---
title: "Input-Data-Format"
output:
  rmarkdown::html_document:
    toc: true
    toc_float: true
    theme: united
vignette: >
  %\VignetteIndexEntry{Input-data-format}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 10
)
```

```{r, include = FALSE, eval=FALSE}
library(devtools)
use_vignette("your-vignette-name")
build_vignettes()
getwd()
rmarkdown::render("Input-data-format.Rmd", output_dir = "../doc/")
```

```{r setup}
library(Aerith)
library(dplyr)
```

### Convert raw file to FT1, FT2, and mzml file  
  
Follow instructions in Aerith README to convert Thermo raw file to FT1, FT2, and mzml file.    
[Convert raw file to FT1, FT2, and mzml file](https://github.com/xyz1396/Aerith/blob/main/README.md#convert-raw-file-to-ft1-ft2-and-mzml-file)  
  
[Link to download Raxport and help pages](https://github.com/xyz1396/Raxport.net)  
[Links to download ThermoRawFileParser](https://github.com/compomics/ThermoRawFileParser/)  
[Links of tutorial of Sipros4](https://github.com/thepanlab/Sipros4)
[Links of tutorial of Sipros5](https://github.com/thepanlab/Sipros5)  
[conda env of Sipros](https://anaconda.org/bioconda/sipros)  

### Read one scan or scans from FT1 and FT2 file

```{r}
demo_file <- system.file("extdata", "demo.FT1", package = "Aerith")
a <- readAllScanMS1(demo_file)
b <- readScansMS1(demo_file, 1527, 1550)
b <- readOneScanMS1(demo_file, 1555)
b <- getRealScanFromList(a[[88]])
plot(b)
demo_file <- system.file("extdata", "demo.FT2", package = "Aerith")
a <- readAllScanMS2(demo_file)
b <- readScansMS2(demo_file, 1399, 1500)
b <- readOneScanMS2(demo_file, 1371)
b <- getRealScanFromList(a[[128]])
plot(b)
```

### Write small demo FT1 FT2 file

```{r}
demo_file <- system.file("extdata", "demo.FT1", package = "Aerith")
header <- readFTheader(demo_file)
ft1 <- readAllScanMS1(demo_file)
tmp <- tempdir()
writeAllScanMS1(header, ft1[1:10], file.path(tmp, "demo10.FT1"))
list.files(tmp, pattern = "demo10.FT1", full.names = TRUE)
```

```{r}
demo_file <- system.file("extdata", "demo.FT2", package = "Aerith")
header <- readFTheader(demo_file)
ft2 <- readAllScanMS2(demo_file)
tmp <- tempdir()
writeAllScanMS2(header, ft2[1:10], file.path(tmp, "demo10.FT2"))
list.files(tmp, pattern = "demo10.FT2", full.names = TRUE)
```

### Read mzml file

```{r}
if (!requireNamespace("mzR", quietly = TRUE)) {
  install.packages("mzR")
}

demo_file <- system.file("extdata", "demo.mzML", package = "Aerith")

mzml1 <- readMzmlMS1(demo_file)
scan1 <- getRealScan(99, mzml1)
plot(scan1)

mzml2 <- readMzmlMS2(demo_file)
scan2 <- getRealScan(33, mzml2)
plot(scan2)
```

### Read mgf file

```{r}
if (!requireNamespace("MSnbase", quietly = TRUE)) {
  install.packages("MSnbase")
}

demo_file <- system.file("extdata", "demo.mgf", package = "Aerith")
a <- readMgf(demo_file)
scan1 <- getRealScan(2688, a)
plot(scan1)
```

### Read PSM from pepXML file

```{r}
if (!requireNamespace("mzR", quietly = TRUE)) {
  install.packages("mzR")
}

demo_file <- system.file("extdata", "demo.pepXML", package = "Aerith")
a <- readPepXMLtable(demo_file)
```

### Read PSM from TSV generated from Sipros

```{r}
demo_file <- system.file("extdata", "demo.psm.txt", package = "Aerith")
psm <- readPSMtsv(demo_file)
```

```{r pro.cluster.txt}
demo_file <- system.file("extdata", "demo.pro.cluster.txt", package = "Aerith")
pro <- readPSMtsv(demo_file)
```

```{r .sip}
demo_file <- system.file("extdata", "demo.sip", package = "Aerith")
sip <- readPSMtsv(demo_file)
```

```{r spe2pep.txt}
target_file <- system.file("extdata", "demo_target.Spe2Pep.txt", package = "Aerith")
psm <- readSpe2Pep(target_file)
psm <- psm$PSM
```

### TIC visualization

```{r}
demo_file <- system.file("extdata", "demo.FT1", package = "Aerith")
a <- readAllScanMS2(demo_file)
b <- getTIC(a)
plotTIC(b, seq(9, 10, by = 0.2))
demo_file <- system.file("extdata", "demo.FT2", package = "Aerith")
a <- readAllScanMS2(demo_file)
b <- getTIC(a)
plotTIC(b, seq(9, 10, by = 0.2))
```

### Scan speed visualization in retention times

```{r}
demo_file <- system.file("extdata", "demo.FT2", package = "Aerith")
a <- readAllScanMS2(demo_file)
a <- getRetentionTimeAndPrecursorInfo(a)
demo_file <- system.file("extdata", "demo.FT1", package = "Aerith")
b <- readAllScanMS1(demo_file)
b <- getRetentionTimeAndPrecursorInfo(b)
plotScanFrequency(a, binwidth = 0.1, breaks = seq(9, 10, by = 0.2)) + plotScanFrequencyMS2(b, binwidth = 0.1)
```

### Precursor density visualization in retention times

```{r}
demo_file <- system.file("extdata", "demo.FT2", package = "Aerith")
a <- readAllScanMS2(demo_file)
a <- getRetentionTimeAndPrecursorInfo(a)
plotPrecursorMzFrequency(a, timeBinWidth = 0.1, x_breaks = seq(8, 11, by = 0.2))
```

```{r session-info}
sessionInfo()
```
